function TestEmail(e){return!!new RegExp("^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$").test(e)}function TestReal(e){var t=!!new RegExp("^[-+]?\\d+$").test(e);return!!t&&e>=0}function TestAlphaNum(e){return!!new RegExp("/[^d]/g").test(e)}!function(){$.dooHighlight=function(e){function t(e,a){if(3==e.nodeType)return r(e,a);if(1==e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(var n=0;n<e.childNodes.length;++n)n+=t(e.childNodes[n],a);return 0}function r(e,t){var r=e.data.toUpperCase().indexOf(t);return r>=0?a(e,r,t):0}function a(t,r,a){n.push(t);var i=$(e.tag)[0],o=t.splitText(r);return o.splitText(a.length),i.appendChild(o.cloneNode(!0)),o.parentNode.replaceChild(i,o),1}for(var n=[],i=$(e.target),o=0,l=i.length;o<l;o++)for(var c=0;c<e.keyWords.length;c++)t(i[o],e.keyWords[c].toUpperCase());return{matchNode:n}}}(jQuery),function(e){e.fn.insertContent=function(t,r){var a=e(this)[0];if(document.selection){this.focus();var n=document.selection.createRange();n.text=t,this.focus(),n.moveStart("character",-o);var i=n.text.length;if(2==arguments.length){var o=a.value.length;n.moveEnd("character",i+r),r<=0?n.moveStart("character",i-2*r-t.length):n.moveStart("character",i-r-t.length),n.select()}}else if(a.selectionStart||"0"==a.selectionStart){var l=a.selectionStart,c=a.selectionEnd,s=a.scrollTop;a.value=a.value.substring(0,l)+t+a.value.substring(c,a.value.length),this.focus(),a.selectionStart=l+t.length,a.selectionEnd=l+t.length,a.scrollTop=s,2==arguments.length&&(a.setSelectionRange(l-r,a.selectionEnd+r),this.focus())}else this.value+=t,this.focus()}}(jQuery),$(function(){if($(document).ready(function(){$("input").keypress(function(e){var t=e.keyCode?e.keyCode:e.which?e.which:e.charCode;if(13==t){var r;for(r=0;r<this.form.elements.length&&this!=this.form.elements[r];r++);return r=(r+1)%this.form.elements.length,this.form.elements[r].focus(),!1}return!0})}),$("#login").length){var e=$("#login"),t={email:!1,password:!1,direct:$("#direct").val()};$("#sign",e).click(function(){var e=!0;for(var r in t)"direct"!=r&&(t[r]=$.trim($("#"+r).val()),0==t[r].length?(e=!1,$("#"+r+"_error").text("这是必填字段！")):($("#"+r+"_error").text(""),"email"==r&&(TestEmail(t[r])||(e=!1,$("#"+r+"_error").text("无效的邮箱！")))));return e&&$.ajax({url:SITEURL+"home/auth",type:"POST",data:t,dataType:"json",success:function(e){if(0==e.valid)for(var t in e.error)$("#"+t+"_error").text(e.error[t]);else window.location.href=e.last_url}}),!1}),$("#reg",e).click(function(){return window.location.href=SITEURL+"home/register",!1})}if($("#register").length){var e=$("#register"),t={email:!1,password:!1,password2:!1,direct:$("#direct").val()};$("#sign",e).click(function(){var e=!0;for(var r in t)"direct"!=r&&(t[r]=$.trim($("#"+r).val()),0==t[r].length?(e=!1,$("#"+r+"_error").text("这是必填字段！")):($("#"+r+"_error").text(""),"email"==r&&(TestEmail(t[r])||(e=!1,$("#"+r+"_error").text("无效的邮箱！"))),"password2"==r&&t[r]!=t.password&&(e=!1,$("#"+r+"_error").text("两次密码不一致！"))));return e&&$.ajax({url:SITEURL+"home/signup",type:"POST",data:t,dataType:"json",success:function(e){if(0==e.valid)for(var t in e.error)$("#"+t+"_error").text(e.error[t]);else window.location.href=e.last_url}}),!1})}if($("#forget").length){var e=$("#forget"),r=!1;$("#send",e).click(function(){return r=$.trim($("#email").val()),0==r.length?$("#email_error").text("这是必填字段！"):TestEmail(r)||(r=!1,$("#email_error").text("无效的邮箱！")),r&&($("#msg,#email_error").text(""),$.ajax({url:SITEURL+"home/send",type:"POST",data:{email:r},dataType:"json",success:function(e){0==e.valid?$("#msg").text(e.error).removeClass("form-note form-success").addClass("form-error"):$("#msg").text("重置密码链接已被发送至您的登录邮箱，请尽快查收").removeClass("form-note form-error").addClass("form-success")}})),!1})}if($("#reset").length){var e=$("#reset"),a={user_id:$("#uid").val(),password:!1,password2:!1,token:$("#token").val()};$("#change",e).click(function(){var e=!0;for(var t in a)"password"!=t&&"password2"!=t||(a[t]=$.trim($("#"+t).val()),0==a[t].length?(e=!1,$("#"+t+"_error").text("这是必填字段！")):($("#"+t+"_error").text(""),"password2"==t&&a[t]!=a.password&&(e=!1,$("#"+t+"_error").text("两次密码不一致！"))));return e&&$.ajax({url:SITEURL+"home/change",type:"POST",data:a,dataType:"json",success:function(e){if(0==e.valid)for(var t in e.error)$("#"+t+"_error").text(e.error[t]);else $("#control").hide(),$("#confirm").fadeIn()}}),!1})}if($("#password").length){var e=$("#password");$("#save",e).click(function(){var e=$.trim($("#pwd").val()),t=$.trim($("#new1").val()),r=$.trim($("#new2").val()),a=!0;return 0==e.length?($("#pwd_error").text("这是必填字段"),a=!1):$("#pwd_error").text(""),0==t.length?($("#new1_error").text("这是必填字段"),a=!1):$("#new1_error").text(""),0==r.length?($("#new2_error").text("这是必填字段"),a=!1):$("#length").text(""),a&&(a=t==r,a?$.ajax({url:SITEURL+"account/reset",type:"POST",data:{pwd:e,new1:t,new2:r},dataType:"json",beforeSend:function(){$("#pwd_error").text(""),$("#new1_error").text(""),$("#new2_error").text("")},success:function(e){if(e.valid)alert("您的密码修改成功！");else for(var t in e.error)$("#"+t+"_error").text(e.error[t])}}):$("#new2_error").text("两次密码不一致")),!1}),$("#cancel",e).click(function(){return window.location.href=SITEURL+"shop",!1})}$("a#logout").click(function(){var e=this.href;return $.ajax({url:e,type:"GET",dataType:"string",success:function(e){window.location.href=SITEURL}}),!1}),$("#notepad #order").change(function(){$("#notepad #query").submit()}),$("#notepad #add,#notepad .detail").click(function(){var e=this.href;return $.ajax({url:SITEURL+"notepad/url",type:"POST",data:{url:window.location.href},dataType:"string",success:function(t){1==t&&(window.location.href=e)}}),!1});var n={title:48,brief:256,content:25e4,tag:3};$("#notepad").ready(function(){var e={title:!1,brief:!1,content:!1};$("#title").attr("maxlength",n.title),$("#title").bind("keyup",function(){if(!e.title){e.brief=!0;var t=$.trim($(this).val());$("#title_length").text("(最多"+n.title+"个字符，已输入"+t.length+"个)").css({color:"#808080","font-size":"13px"}),e.brief=!1}}).trigger("keyup"),$("#brief").attr("maxlength",n.brief),$("#brief").bind("keyup",function(){if(!e.brief){e.brief=!0;var t=$.trim($(this).val());$("#brief_length").text("(最多"+n.brief+"个字符，已输入"+t.length+"个)").css({color:"#808080","font-size":"13px"}),e.brief=!1}}).trigger("keyup"),$("#content").attr("maxlength",n.content),$("#content").bind("keyup",function(){if(!e.content){e.content=!0;var t=$.trim($(this).val());$("#content_length").text("(最多"+n.content.toString().replace(/0000/,"万")+"个字符，已输入"+t.length+"个)").css({color:"#808080","font-size":"13px"}),e.content=!1}}).trigger("keyup"),$("#tag_length").text("(最多"+n.tag+"个分类)").css({color:"#808080","font-size":"13px"})}),$("#notepad #save").click(function(){var e=$("#notepad"),t={id:$.trim($("#id",e).val()),title:$.trim($("#title",e).val()),brief:$.trim($("#brief",e).val()),content:$.trim($("#content",e).val()),tag:[],captcha:$.trim($("#captcha",e).val())};$("input[name='tag[]']:checked").each(function(){t.tag.push(this.value)});var r=!0;for(var a in t)$("#"+a+"_error").text(""),0==t[a].length?(r=!1,$("#"+a+"_error").text("这是必填字段！")):null!=n[a]&&t[a].length>n[a]&&(r=!1,$("#"+a+"_error").text("超过字数限制！"));return r&&(t.tag=t.tag.join(","),$.ajax({url:SITEURL+"notepad/save",type:"POST",data:t,dataType:"json",success:function(e){if(0==e.valid){for(var t in e.error)$("#"+t+"_error").text(e.error[t]);$("#captcha_img").trigger("click")}else window.location.href=e.last_url}})),!1}),$("#notepad #delete").click(function(){return confirm("确定要删除该提词分享？")&&($(this).attr("disabled","true"),$("#notepad #like").attr("disabled","true"),$.ajax({url:SITEURL+"notepad/delete",type:"POST",data:{id:$.trim($("#id").val())},success:function(e){alert(e.last_url)}})),!1}),$("#notepad #like").click(function(){return $.ajax({url:SITEURL+"notepad/favorite",type:"POST",data:{id:$.trim($("#id").val()),favor:$("#favorite").val()},dataType:"json",success:function(e){if(e.favorite<0)window.location.href=e.last_url;else{var t=e.favorite?"不收藏":"收藏";$("#favorite").val(e.favorite?0:1),$("#like_text").text(t).fadeIn(500),$("#like_value").text("("+e.like+")").fadeIn(500)}}}),!1}),$("#custom #add,#custom .detail").click(function(){var e=this.href;return $.ajax({url:SITEURL+"custom/url",type:"POST",data:{url:window.location.href},dataType:"string",success:function(t){1==t&&(window.location.href=e)}}),!1}),$("#custom").ready(function(){var e=!1,t="";$("#voc").bind("blur",function(){var r=($("#id").val(),$.trim($(this).val())),a=$("#type").val();return!e&&r.length&&r!=t&&$.ajax({url:SITEURL+"custom/check",type:"POST",data:{type:a,voc:r},dataType:"json",beforeSend:function(){e=!0,$("#voc_error").text("正在检查，请稍候……")},success:function(e){e.valid?($("#voc_id").val(e.voc.id),$("#voc_error").text(""),t=e.voc.vocabulary):$("#voc_error").html(e.error)},complete:function(){e=!1},timeout:5e3}),!1}),$(".alike").live("click",function(){return $("#voc").val($(this).text()),$("#voc_id").val(this.id.split("_")[1]),$("#voc_error").text(""),t=$("#voc").val(),!1}),$("#phrase").bind("keyup",function(){var e=$.trim($(this).val());$("#phrase_length").text("(最多"+length.phrase.max+"个字符，已输入"+e.length+"个)").css({color:"#808080","font-size":"13px"});var t=e.length>length.phrase.max?"超过字符限制！":"";$("#phrase_error").text(t)}).trigger("keyup"),$("#phrase").blur(function(){var e=$.trim($(this).val()).replace(/(\r\n|\n|\r)/gm,"");e=e.replace(/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/gm,""),e=e.replace(/^[\u4e00-\u9fa5]+$/,""),$(this).val(e)}),$("#interp").bind("keyup",function(){var e=$.trim($(this).val());$("#interp_length").text("(最多"+length.interpretation.max+"个中文字符，已输入"+e.length+"个)").css({color:"#808080","font-size":"13px"});var t=e.length>length.interpretation.max?"超过字符限制！":"";$("#interp_error").text(t)}).trigger("keyup"),$("#save_phrase,#save_phrase_next").click(function(){var e=this.id.search(/next/)!=-1,r=$("#custom"),a={id:$.trim($("#id",r).val()),voc:$.trim($("#voc_id",r).val()),phrase:$.trim($("#phrase",r).val()),interpretation:$.trim($("#interp",r).val()),captcha:$.trim($("#captcha",r).val())},n=!0;for(var i in a)$("#"+i+"_error").text(""),0==a[i].length?(n=!1,$("#"+i+"_error").text("voc"==i?"未找到相关单词，请检查单词拼写（注意区分大小写）":"这是必填字段！")):void 0!=length[i]&&a[i].length>length[i].max&&(n=!1,$("#"+i+"_error").text("超过字符限制！"));return n&&$.ajax({url:SITEURL+"custom/save/"+$("#type").val(),type:"POST",data:a,dataType:"json",success:function(a){if(0==a.valid){for(var n in a.error)$("#"+n+"_error").text(a.error[n]);$("#captcha",r).val(""),$("#captcha_img",r).trigger("click")}else $("#success").text("例句添加成功！").fadeIn(500).fadeOut(1e3),e?($("#voc_id,#voc,#phrase,#interp,#captcha",r).val(""),$("#phrase,#interp",r).trigger("keyup"),$("#captcha_img",r).trigger("click"),t=""):window.location.href=$("#last_url")[0].href}}),!1}),$("#note").bind("keyup",function(){var e=$.trim($(this).val());$("#note_length").text("(最多"+length.note.max+"个字符，已输入"+e.length+"个)").css({color:"#808080","font-size":"13px"});var t=e.length>length.note.max?"超过字符限制！":"";$("#note_error").text(t)}).trigger("keyup"),$("#note").blur(function(){var e=$.trim($(this).val()).replace(/(\r\n|\n|\r)/gm,"\r\n").split("\r\n"),t=[];for(var r in e)if(e[r].length&&(t.push(e[r]),t.length>=7))break;$(this).val(t.join("\r\n"))}),$(".label").click(function(){return $(".label").removeClass("active").css({border:"1px solid #ddd"}),$(this).addClass("active").css({border:"1px solid red"}),$("#label").val($(this).text()),!1}),$("#save_note,#save_note_next").click(function(){var e=this.id.search(/next/)!=-1,r=$("#custom"),a={id:$.trim($("#id",r).val()),voc:$.trim($("#voc_id",r).val()),note:$.trim($("#note",r).val()),label:$.trim($("#label",r).val()),captcha:$.trim($("#captcha",r).val())},n=!0;for(var i in a)$("#"+i+"_error").text(""),0==a[i].length?(n=!1,$("#"+i+"_error").text("voc"==i?"未找到相关单词，请检查单词拼写（注意区分大小写）":"这是必填字段！")):void 0!=length[i]&&a[i].length>length[i].max&&(n=!1,$("#"+i+"_error").text("超过字符限制！"));return n&&$.ajax({url:SITEURL+"custom/save/"+$("#type").val(),type:"POST",data:a,dataType:"json",success:function(a){if(0==a.valid){for(var n in a.error)$("#"+n+"_error").text(a.error[n]);$("#captcha",r).val(""),$("#captcha_img",r).trigger("click")}else $("#success").text("助记添加成功！").fadeIn(500).fadeOut(1e3),e?($("#voc_id,#voc,#note,#captcha",r).val(""),$("#note",r).trigger("keyup"),$("#captcha_img",r).trigger("click"),t=""):window.location.href=$("#last_url")[0].href}}),!1}),$(".delete").click(function(){var e=this.href,t=e.search(/phrase/i)==-1?"助记":"例句";if(confirm("确定要删除此"+t+"吗？")){var e=this.href;$.ajax({url:SITEURL+"custom/url",type:"POST",data:{url:window.location.href},dataType:"string",success:function(t){1==t&&(window.location.href=e)}})}return!1})})});